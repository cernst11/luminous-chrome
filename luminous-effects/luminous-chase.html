<dom-module id="luminous-chase">
  <template>
    <style>
       :host {
        display: inline-block;
        position: relative;
      }
      
      paper-color-circle {
        width: 200px;
        height: 200px;
      }
      
      .flexchild {
        @apply(--layout-flex);
      }
      
      .color-button {
        background-color: var(--paper-cyan-500);
        color: white;
        --paper-button-raised-keyboard-focus: {
          background-color: var(--paper-red-a200) !important;
          color: white !important;
        }
        ;
      }
      
      #chase-selection-button {
        background-color: #FF1744;
        color: white;
        width: 80px;
      }

    </style>

    <template is="dom-if" if="{{!showSettings}}">
      <paper-button id="chase-selection-button" on-down="_pntrDown" on-up="clearEventTimeout"  class="paper-font-body1" on-tap="sendEffect" data-args="rotate" raised>Chase</paper-button>
    </template>

    <template is="dom-if" if="{{showSettings}}">
      <div class="settings-container">
        <paper-button id="activate-settings" class="paper-font-body1 rainbow" on-tap="sendEffect"  raised id="rainbow">Chase</paper-button>
        <div class="slider-container">
          <label>Speed</label>
          <paper-slider max-markers="20" step="5" max="200" value="{{refresh}}"></paper-slider>
        </div>
        <div class="slider-container">
          <label>Number of LED's Lit</label>
          <paper-slider max-markers="60" pin step="1" max="60" value="{{effectProperties.lit}}"></paper-slider>
        </div>
      </div>
    </template>
  </template>

  </template>


  <script>
    Polymer({
      is: 'luminous-chase',


      properties: {

        effectProperties: {
          type: Object,
          notify: true,
          value: {
            refresh: 50,
            color: '0xFF00FF',
            lit: 15
          }
        },


        effectName: {
          type: String,
          readOnly: true,
          value: 'theaterChase'
        },

        /**
         *The state of the light strip
         **/
        stripState: {
          type: Object,
          notify: true
        },


        showSettings: {
          type: Boolean,
          value: false
        },


        /**
         *The device url and port number
         **/
        deviceurl: {
          type: String
        },

        refresh: {
          type: Number
        }

      },

      observers: [

            '_calculateRefeshRate(refresh)'
      ],

      ready: function () {
        

      },

      _computeEffectUrl: function (url, effectName) {

        return [url, 'api', 'effects', effectName].join('/');
      },

      handleEffectResponse: function (data) {
        //this.cardInitialized = true;
        this.stripState = data.detail.response.stripState;

      },

      sendEffect: function () {
        this.fire('sendEffect', {
          effectProperties: this.effectProperties,
          effectName: 'theaterChase'
        });

      },

      _pntrDown: function (index) {
        let that = this;
        timer = setTimeout(function () {
          that.fire('goToSettings', {
            settings: 'theaterChase'
          });
        }, 1000);
      },
      clearEventTimeout: function () {
        clearTimeout(timer);
      },

      _calculateRefeshRate(speed) {
        console.log(speed);
        let calculatedSpeed = Math.min(Math.max(parseInt(200 - speed), 1), 200)
        console.log(typeof calculatedSpeed + ' ' + calculatedSpeed)
        this.effectProperties.refresh = calculatedSpeed;
        // console.log(this.effectProperties.refresh);
      }

    });

  </script>



</dom-module>
